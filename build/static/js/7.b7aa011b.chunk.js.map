{"version":3,"sources":["components/Search.js"],"names":["Search","appDispatch","useContext","DispatchContext","useImmer","searchTerm","results","show","requestCounter","state","setState","searchKeyHandler","e","keyCode","type","useEffect","trim","draft","delay","setTimeout","clearTimeout","fetchResults","a","Axios","post","cancelToken","ourReq","token","response","data","console","log","CancelToken","source","cancel","document","addEventListener","removeEventListener","className","htmlFor","onChange","value","target","autoFocus","autoComplete","id","placeholder","onClick","preventDefault","Boolean","length","map","_id"],"mappings":"uMAqHeA,UA9Gf,WACA,IAAMC,EAAcC,qBAAWC,KAE/B,EAAuBC,YAAS,CAC9BC,WAAW,GACXC,QAAQ,GACRC,KAAK,UACLC,eAAe,IAJjB,mBAAOC,EAAP,KAAaC,EAAb,KAiDA,SAASC,EAAiBC,GACN,IAAbA,EAAEC,SACDZ,EAAY,CAACa,KAAK,gBAiBtB,OA7DJC,qBAAU,WACR,GAAGN,EAAMJ,WAAWW,OAAO,CACzBN,GAAS,SAAAO,GACPA,EAAMV,KAAK,aAEb,IAAMW,EAAOC,YAAW,WACtBT,GAAS,SAAAO,GACPA,EAAMT,sBAEN,KACF,OAAM,kBAAKY,aAAaF,IAE1BR,GAAS,SAAAO,GACPA,EAAMV,KAAK,eAGf,CAACE,EAAMJ,aAETU,qBAAU,WACR,GAAGN,EAAMD,eAAe,CAAC,IAERa,EAFO,uCAEtB,4BAAAC,EAAA,+EAE0BC,IAAMC,KAAK,UAAU,CAACnB,WAAWI,EAAMJ,YAAY,CAACoB,YAAYC,EAAOC,QAFjG,OAEUC,EAFV,OAGIlB,GAAS,SAAAO,GACPA,EAAMX,QAAQsB,EAASC,KACvBZ,EAAMV,KAAK,aALjB,gDAQIuB,QAAQC,IAAI,WARhB,yDAFsB,qDAChBL,EAAOH,IAAMS,YAAYC,SAa/B,OADAZ,IACO,kBAAIK,EAAOQ,aAEpB,CAACzB,EAAMD,iBAETO,qBAAU,WAEN,OADAoB,SAASC,iBAAiB,QAAQzB,GAC3B,kBAAKwB,SAASE,oBAAoB,QAAQ1B,MACnD,IAsBM,qCACF,qBAAK2B,UAAU,+BAAf,SACE,sBAAKA,UAAU,8BAAf,UACE,uBAAOC,QAAQ,oBAAoBD,UAAU,sBAA7C,SACE,mBAAGA,UAAU,oBAEf,uBACAE,SAfV,SAAqB5B,GACnB,IAAM6B,EAAQ7B,EAAE8B,OAAOD,MACvB/B,GAAS,SAAAO,GACPA,EAAMZ,WAAWoC,MAaXE,WAAS,EAAC7B,KAAK,OAAO8B,aAAa,MAAMC,GAAG,oBAAoBP,UAAU,oBAAoBQ,YAAY,gCAE1G,sBAAMC,QAvBhB,SAAsBnC,GAClBA,EAAEoC,iBACF/C,EAAY,CAACa,KAAM,iBAqBgBwB,UAAU,oBAAvC,SACE,mBAAGA,UAAU,+BAKnB,qBAAKA,UAAU,wBAAf,SACE,sBAAKA,UAAU,mCAAf,UACE,qBAAKA,UAAW,kBAAkC,WAAd7B,EAAMF,KAAoB,yBAA0B,MACtF,sBAAK+B,UAAW,wBAAwC,WAAd7B,EAAMF,KAAoB,+BAAgC,IAApG,UACG0C,QAAQxC,EAAMH,QAAQ4C,SACrB,sBAAKZ,UAAU,uBAAf,UACA,sBAAKA,UAAU,yBAAf,UAAwC,oDAAxC,KAA0E7B,EAAMH,QAAQ4C,OAAxF,IAAiGzC,EAAMH,QAAQ4C,OAAO,EAAI,QAAS,OAAnI,aACGzC,EAAMH,QAAQ6C,KAAI,SAAA3B,GACnB,OAAO,cAAC,IAAD,CAAMA,KAAMA,EACnBuB,QAAS,kBAAI9C,EAAY,CAACa,KAAK,kBADDU,EAAK4B,YAMvCH,QAAQxC,EAAMH,QAAQ4C,SAAU,mBAAGZ,UAAU,2CAAb","file":"static/js/7.b7aa011b.chunk.js","sourcesContent":["import React,{useContext,useEffect} from 'react';\r\nimport DispatchContext from '../DispatchContext';\r\nimport {useImmer} from 'use-immer';\r\nimport Axios from 'axios';\r\nimport {Link} from 'react-router-dom';\r\nimport Post from './Post'\r\n\r\nfunction Search() {\r\nconst appDispatch = useContext(DispatchContext);\r\n\r\nconst [state,setState]=useImmer({\r\n  searchTerm:'',\r\n  results:[],\r\n  show:'neither',\r\n  requestCounter:0,\r\n})\r\n\r\nuseEffect(()=>{\r\n  if(state.searchTerm.trim()){\r\n    setState(draft=>{\r\n      draft.show='loading';\r\n    })\r\n    const delay= setTimeout(()=>{\r\n      setState(draft=>{\r\n        draft.requestCounter++\r\n      })\r\n      },700)\r\n      return()=> clearTimeout(delay)\r\n  }else{\r\n    setState(draft=>{\r\n      draft.show='neither';\r\n    })\r\n  }\r\n},[state.searchTerm]);\r\n\r\nuseEffect(()=>{\r\n  if(state.requestCounter){\r\n    const ourReq=Axios.CancelToken.source();\r\n    async function fetchResults(){\r\n      try {\r\n        const response =await Axios.post('/search',{searchTerm:state.searchTerm},{cancelToken:ourReq.token});\r\n        setState(draft=>{\r\n          draft.results=response.data;\r\n          draft.show='results';\r\n        });\r\n      } catch (error) {\r\n        console.log('error !')\r\n      }\r\n    }\r\n    fetchResults();\r\n    return ()=>ourReq.cancel();\r\n  } \r\n},[state.requestCounter])\r\n\r\nuseEffect(() =>{\r\n    document.addEventListener('keyup',searchKeyHandler);\r\n    return ()=> document.removeEventListener('keyup',searchKeyHandler);\r\n},[])\r\n\r\nfunction searchKeyHandler(e){\r\n    if(e.keyCode == 27){\r\n        appDispatch({type:'closeSearch'})\r\n    }\r\n}\r\n\r\n\r\nfunction closeHandler(e){\r\n    e.preventDefault();\r\n    appDispatch({type: 'closeSearch'})\r\n}\r\n\r\nfunction handleInput(e){\r\n  const value = e.target.value;\r\n  setState(draft=>{\r\n    draft.searchTerm=value;\r\n  })\r\n}\r\n\r\n    return (\r\n        <>\r\n      <div className=\"search-overlay-top shadow-sm\">\r\n        <div className=\"container container--narrow\">\r\n          <label htmlFor=\"live-search-field\" className=\"search-overlay-icon\">\r\n            <i className=\"fas fa-search\"></i>\r\n          </label>\r\n          <input \r\n          onChange={handleInput}\r\n          autoFocus type=\"text\" autoComplete=\"off\" id=\"live-search-field\" className=\"live-search-field\" placeholder=\"What are you interested in?\" />\r\n\r\n          <span onClick={closeHandler} className=\"close-live-search\">\r\n            <i className=\"fas fa-times-circle\"></i>\r\n          </span>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"search-overlay-bottom\">\r\n        <div className=\"container container--narrow py-3\">\r\n          <div className={'circle-loader ' + (state.show == 'loading' ? 'circle-loader--visible' :'')}></div> \r\n            <div className={'live-search-results ' + (state.show == 'results' ? 'live-search-results--visible' :'')}>\r\n              {Boolean(state.results.length) && (\r\n                <div className=\"list-group shadow-sm\">\r\n                <div className=\"list-group-item active\"><strong>Search Results</strong> ({state.results.length} {state.results.length>1 ? 'items': 'item' } )found</div>\r\n                  {state.results.map(post=>{\r\n                  return <Post post={post} key={post._id}\r\n                  onClick={()=>appDispatch({type:'closeSearch'})}\r\n                  />\r\n                  })}\r\n            </div>\r\n            )}\r\n            {!Boolean(state.results.length)&& <p className=\"text-center alert-danger alert shadow-sm\">Whoops !, We couldn't find any results for this search ðŸ™„</p>}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n    )\r\n}\r\n\r\nexport default Search\r\n"],"sourceRoot":""}